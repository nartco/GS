import React from 'react';
import { createAppStartSpan } from './create-app-start-span.js';

const platformExtensions = (appStartTime, clock, spanFactory, spanContextStorage) => ({
    startNavigationSpan: (routeName, spanOptions) => {
        const cleanOptions = spanFactory.validateSpanOptions(routeName, spanOptions);
        cleanOptions.options.isFirstClass = true;
        const span = spanFactory.startSpan(`[Navigation]${cleanOptions.name}`, cleanOptions.options);
        span.setAttribute('bugsnag.span.category', 'navigation');
        span.setAttribute('bugsnag.navigation.route', cleanOptions.name);
        return spanFactory.toPublicApi(span);
    },
    withInstrumentedAppStarts: (App) => {
        const appStartSpan = createAppStartSpan(spanFactory, appStartTime);
        return () => {
            React.useEffect(() => {
                if (appStartSpan.isValid()) {
                    spanFactory.endSpan(appStartSpan, clock.now());
                }
            }, []);
            return <App />;
        };
    }
});

export { platformExtensions };
