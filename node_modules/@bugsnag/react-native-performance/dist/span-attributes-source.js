import NetInfo from '@react-native-community/netinfo';
import getNetworkConnectionType from './get-network-connection-type.js';

function createSpanAttributesSource() {
    let connectionType = 'unknown';
    let cellularGeneration;
    // Subscribe to network changes
    NetInfo.addEventListener(state => {
        connectionType = getNetworkConnectionType(state.type);
        // @ts-expect-error cellularGeneration does not exist on type
        cellularGeneration = state.details?.cellularGeneration;
    });
    const spanAttributesSource = {
        configure(configuration) { },
        requestAttributes(span) {
            span.setAttribute('net.host.connection.type', connectionType);
            if (cellularGeneration && connectionType === 'cell') {
                span.setAttribute('net.host.connection.subtype', cellularGeneration);
            }
        }
    };
    return spanAttributesSource;
}

export { createSpanAttributesSource };
