{"version":3,"sources":["ImageGallery.tsx"],"names":["React","useEffect","useRef","useState","useCallback","Dimensions","FlatList","Image","Modal","StyleSheet","TouchableOpacity","View","ImagePreview","SwipeContainer","height","deviceHeight","width","deviceWidth","get","defaultProps","hideThumbs","resizeMode","thumbColor","thumbResizeMode","thumbSize","ImageGallery","props","close","images","initialIndex","isOpen","renderCustomImage","renderCustomThumb","renderFooterComponent","renderHeaderComponent","disableSwipe","activeIndex","setActiveIndex","isDragging","setIsDragging","topRef","bottomRef","keyExtractorThumb","item","index","id","toString","keyExtractorImage","scrollToIndex","i","current","animated","renderItem","renderThumb","styles","thumb","activeThumb","borderColor","uri","thumbUrl","url","onMomentumEnd","e","x","nativeEvent","contentOffset","Math","round","getImageLayout","_","length","offset","getThumbLayout","container","thumbnailListContainer","bottomFlatlist","bottom","header","footer","create","alignItems","backgroundColor","flex","justifyContent","position","top","borderWidth","borderRadius","marginRight","paddingHorizontal"],"mappings":"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","sourcesContent":["import React, { useEffect, useRef, useState, useCallback } from 'react';\nimport {\n  Dimensions,\n  FlatList,\n  Image,\n  Modal,\n  StyleSheet,\n  TouchableOpacity,\n  View,\n} from 'react-native';\nimport { ImageObject, IProps, RenderImageProps } from './types';\nimport ImagePreview from './ImagePreview';\nimport SwipeContainer from './SwipeContainer';\n\nconst { height: deviceHeight, width: deviceWidth } = Dimensions.get('window');\n\nconst defaultProps = {\n  hideThumbs: false,\n  resizeMode: 'contain',\n  thumbColor: '#d9b44a',\n  thumbResizeMode: 'cover',\n  thumbSize: 48,\n};\n\nconst ImageGallery = (props: IProps & typeof defaultProps) => {\n  const {\n    close,\n    hideThumbs,\n    images,\n    initialIndex,\n    isOpen,\n    renderCustomImage,\n    renderCustomThumb,\n    renderFooterComponent,\n    renderHeaderComponent,\n    resizeMode,\n    thumbColor,\n    thumbResizeMode,\n    thumbSize,\n    disableSwipe,\n  } = props;\n\n  const [activeIndex, setActiveIndex] = useState(0);\n  const [isDragging, setIsDragging] = useState(false);\n  const topRef = useRef<FlatList>(null);\n  const bottomRef = useRef<FlatList>(null);\n\n  const keyExtractorThumb = (item: ImageObject, index: number) =>\n    item && item.id ? item.id.toString() : index.toString();\n  const keyExtractorImage = (item: ImageObject, index: number) =>\n    item && item.id ? item.id.toString() : index.toString();\n\n  const scrollToIndex = (i: number) => {\n    setActiveIndex(i);\n\n    if (topRef?.current) {\n      topRef.current.scrollToIndex({\n        animated: true,\n        index: i,\n      });\n    }\n    if (bottomRef?.current) {\n      if (i * (thumbSize + 10) - thumbSize / 2 > deviceWidth / 2) {\n        bottomRef?.current?.scrollToIndex({\n          animated: true,\n          index: i,\n        });\n      } else {\n        bottomRef?.current?.scrollToIndex({\n          animated: true,\n          index: 0,\n        });\n      }\n    }\n  };\n\n  const renderItem = ({ item, index }: RenderImageProps) => {\n    return (\n      <ImagePreview\n        index={index}\n        isSelected={activeIndex === index}\n        item={item}\n        resizeMode={resizeMode}\n        renderCustomImage={renderCustomImage}\n      />\n    );\n  };\n\n  const renderThumb = ({ item, index }: RenderImageProps) => {\n    return (\n      <TouchableOpacity\n        onPress={() => scrollToIndex(index)}\n        activeOpacity={0.8}\n      >\n        {renderCustomThumb ? (\n          renderCustomThumb(item, index, activeIndex === index)\n        ) : (\n          <Image\n            resizeMode={thumbResizeMode}\n            style={\n              activeIndex === index\n                ? [\n                    styles.thumb,\n                    styles.activeThumb,\n                    { borderColor: thumbColor },\n                    { width: thumbSize, height: thumbSize },\n                  ]\n                : [styles.thumb, { width: thumbSize, height: thumbSize }]\n            }\n            source={{ uri: item.thumbUrl ? item.thumbUrl : item.url }}\n          />\n        )}\n      </TouchableOpacity>\n    );\n  };\n\n  const onMomentumEnd = (e: any) => {\n    const { x } = e.nativeEvent.contentOffset;\n    scrollToIndex(Math.round(x / deviceWidth));\n  };\n\n  useEffect(() => {\n    if (isOpen && initialIndex) {\n      setActiveIndex(initialIndex);\n    } else if (!isOpen) {\n      setActiveIndex(0);\n    }\n  }, [isOpen, initialIndex]);\n\n  const getImageLayout = useCallback((_, index) => {\n    return {\n      index,\n      length: deviceWidth,\n      offset: deviceWidth * index,\n    };\n  }, []);\n\n  const getThumbLayout = useCallback(\n    (_, index) => {\n      return {\n        index,\n        length: thumbSize,\n        offset: thumbSize * index,\n      };\n    },\n    [thumbSize]\n  );\n\n  return (\n    <Modal animationType={isOpen ? 'slide' : 'fade'} visible={isOpen}>\n      <View style={styles.container}>\n        <SwipeContainer\n          disableSwipe={disableSwipe}\n          setIsDragging={setIsDragging}\n          close={close}\n        >\n          <FlatList\n            initialScrollIndex={initialIndex}\n            getItemLayout={getImageLayout}\n            data={images}\n            horizontal\n            keyExtractor={keyExtractorImage}\n            onMomentumScrollEnd={onMomentumEnd}\n            pagingEnabled\n            ref={topRef}\n            renderItem={renderItem}\n            scrollEnabled={!isDragging}\n            showsHorizontalScrollIndicator={false}\n          />\n        </SwipeContainer>\n        {hideThumbs ? null : (\n          <FlatList\n            initialScrollIndex={initialIndex}\n            getItemLayout={getThumbLayout}\n            contentContainerStyle={styles.thumbnailListContainer}\n            data={props.images}\n            horizontal\n            keyExtractor={keyExtractorThumb}\n            pagingEnabled\n            ref={bottomRef}\n            renderItem={renderThumb}\n            showsHorizontalScrollIndicator={false}\n            style={[styles.bottomFlatlist, { bottom: thumbSize }]}\n          />\n        )}\n        {renderHeaderComponent ? (\n          <View style={styles.header}>\n            {renderHeaderComponent(images[activeIndex], activeIndex)}\n          </View>\n        ) : null}\n        {renderFooterComponent ? (\n          <View style={styles.footer}>\n            {renderFooterComponent(images[activeIndex], activeIndex)}\n          </View>\n        ) : null}\n      </View>\n    </Modal>\n  );\n};\n\nconst styles = StyleSheet.create({\n  container: {\n    alignItems: 'center',\n    backgroundColor: 'black',\n    flex: 1,\n    height: deviceHeight,\n    justifyContent: 'center',\n    width: deviceWidth,\n  },\n\n  header: {\n    position: 'absolute',\n    top: 0,\n    width: '100%',\n  },\n  footer: {\n    bottom: 0,\n    position: 'absolute',\n    width: '100%',\n  },\n  activeThumb: {\n    borderWidth: 3,\n  },\n  thumb: {\n    borderRadius: 12,\n    marginRight: 10,\n  },\n  thumbnailListContainer: {\n    paddingHorizontal: 10,\n  },\n  bottomFlatlist: {\n    position: 'absolute',\n  },\n});\n\nImageGallery.defaultProps = defaultProps;\n\nexport default ImageGallery;\n"]}