{"version":3,"sources":["PanContainer.tsx"],"names":["React","useRef","Animated","PanResponder","View","getDistance","getScale","PanContainer","children","close","setIsDragging","translationXY","ValueXY","current","scale","Value","_initialTouches","onRelease","_","gestureState","dy","length","parallel","timing","duration","toValue","useNativeDriver","x","y","start","panResponder","create","onStartShouldSetPanResponder","onMoveShouldSetPanResponder","absDx","Math","abs","dx","absDY","numberActiveTouches","onPanResponderGrant","evt","nativeEvent","touches","setOffset","onPanResponderMove","setValue","currentDistance","initialDistance","newScale","onPanResponderTerminationRequest","onPanResponderRelease","onPanResponderTerminate","panHandlers","transform","translateX","translateY"],"mappings":"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","sourcesContent":["import React, { useRef } from 'react';\nimport {\n  Animated,\n  GestureResponderEvent,\n  PanResponder,\n  PanResponderGestureState,\n  View,\n} from 'react-native';\nimport { getDistance, getScale } from './_helpers';\n\nconst PanContainer = ({\n  children,\n  close,\n  setIsDragging,\n}: {\n  children: any;\n  close: () => void;\n  setIsDragging: any;\n}) => {\n  const translationXY = useRef(new Animated.ValueXY()).current;\n  const scale = useRef(new Animated.Value(1)).current;\n  let _initialTouches: any = useRef().current;\n\n  const onRelease = (\n    _: GestureResponderEvent,\n    gestureState: PanResponderGestureState\n  ): void | boolean => {\n    setIsDragging(false);\n    if (gestureState.dy > 180 && _initialTouches.length === 1) {\n      close();\n      return false;\n    }\n\n    Animated.parallel([\n      Animated.timing(scale, {\n        duration: 100,\n        toValue: 1,\n        useNativeDriver: true,\n      }),\n\n      Animated.timing(translationXY.x, {\n        duration: 100,\n        toValue: 0,\n        useNativeDriver: true,\n      }),\n      Animated.timing(translationXY.y, {\n        duration: 100,\n        toValue: 0,\n        useNativeDriver: true,\n      }),\n    ]).start();\n  };\n\n  const panResponder = React.useRef(\n    PanResponder.create({\n      onStartShouldSetPanResponder: () => true,\n      onMoveShouldSetPanResponder: (\n        _: GestureResponderEvent,\n        gestureState: PanResponderGestureState\n      ) => {\n        const absDx = Math.abs(gestureState.dx);\n        const absDY = Math.abs(gestureState.dy);\n        if (absDY > 5 && absDx <= 2 && gestureState.numberActiveTouches <= 1) {\n          return true;\n        }\n        if (absDx > 0 && gestureState.numberActiveTouches <= 1) {\n          return false;\n        }\n        return true;\n      },\n      // onMoveShouldSetPanResponderCapture: (evt, gestureState) => true,\n\n      onPanResponderGrant: (evt: GestureResponderEvent) => {\n        setIsDragging(true);\n        _initialTouches = evt.nativeEvent.touches;\n\n        translationXY.setOffset({\n          x: 0,\n          y: 0,\n        });\n        return true;\n      },\n      onPanResponderMove: (\n        evt: GestureResponderEvent,\n        gestureState: PanResponderGestureState\n      ) => {\n        const { touches } = evt.nativeEvent;\n\n        if (touches.length <= 1 && Math.abs(gestureState.dy) > 10) {\n          translationXY.y.setValue(gestureState.dy);\n          return true;\n        }\n        if (touches.length <= 1 && Math.abs(gestureState.dx) > 0) {\n          setIsDragging(false);\n          return false;\n        }\n        if (touches.length < 2) {\n          // Trigger a release\n          onRelease(evt, gestureState);\n          return false;\n        }\n\n        const { dx, dy } = gestureState;\n        translationXY.x.setValue(dx);\n        translationXY.y.setValue(dy);\n        // for scaling photo\n        const currentDistance = getDistance(touches);\n        const initialDistance = getDistance(_initialTouches);\n        const newScale = getScale(currentDistance, initialDistance);\n        scale.setValue(newScale);\n        return true;\n      },\n      onPanResponderTerminationRequest: () => {\n        return true;\n      },\n      onPanResponderRelease: (\n        evt: GestureResponderEvent,\n        gestureState: PanResponderGestureState\n      ) => {\n        onRelease(evt, gestureState);\n        return true;\n      },\n      onPanResponderTerminate: () => true,\n    })\n  ).current;\n\n  return (\n    <View>\n      <Animated.View\n        {...panResponder.panHandlers}\n        style={{\n          transform: [\n            {\n              translateX: translationXY.x,\n            },\n            {\n              translateY: translationXY.y,\n            },\n            { scale: scale },\n          ],\n        }}\n      >\n        {children}\n      </Animated.View>\n    </View>\n  );\n};\n\nexport default PanContainer;\n"]}